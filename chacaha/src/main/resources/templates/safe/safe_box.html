<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì°¨ê³¡ì°¨ê³¡ ê¸ˆê³ </title>

  <link rel="stylesheet" href="/css/safe_box.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <!-- ìƒë‹¨ë°” -->
  <header class="topbar">
    <div class="topbar-inner">
      <button class="btn-ghost">ë¡œê·¸</button>
      <a href="#" class="link">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
  </header>

  <div class="page">
    <!-- ì‚¬ì´ë“œ -->
    <aside class="sidebar">
      <div class="profile">
        <div class="avatar">ğŸ‘¤</div>
        <div class="grade">ê¸ˆìœµíšŒì› ë“±ê¸‰</div>
      <div class="name" th:text="${(user != null and user.name != null) ? user.name : 'ì´ìˆ˜ì—°'}">ì´ìˆ˜ì—°</div>

      </div>

      <div class="divider"></div>

      <nav class="mymenu">
        <a class="item">ì˜ˆì‚° ì„¤ì • ì •ë³´</a>

        <div class="mini-card">
          <div class="mini-title">ì˜ˆì‚° ì„¤ì • ì •ë³´</div>
          <ul class="mini-list">
            <li>ì›”ì˜ˆì‚°: 2,000,000ì›</li>
            <li>ì‹ë¹„: 300,000ì›</li>
            <li>êµí†µ: 100,000ì›</li>
            <li>ì €ì¶•: 300,000ì›</li>
          </ul>
        </div>

        <a class="item">ì˜ˆì‚°ì›í‘œ ì¡°íšŒ</a>
        <a class="item">ì˜ˆì‚°ìƒì„¸</a>
        <a class="item">ì†Œë¹„ë‚´ì—­ ì¡°íšŒ</a>
        <a class="item">ì„¸ì´í”„ ë°•ìŠ¤</a>
        <a class="item active">ì°¨ê³¡ì°¨ê³¡ ê¸ˆê³ </a>
        <a class="item">ë¯¸ë‹ˆê¸ˆê³  ì…ì¶œë‚´ì—­</a>
      </nav>
    </aside>

    <!-- ë³¸ë¬¸ -->
    <main class="content">
      <h1 class="page-title">ì°¨ê³¡ì°¨ê³¡ ê¸ˆê³ </h1>

      <!-- ì¹´ë“œ: ëª©í‘œ ë‹¬ì„±ìœ¨ -->
      <section class="card">
        <div class="card-title">ëª©í‘œ ë‹¬ì„±ìœ¨</div>

        <div class="progress">
          <<span th:style="|width:${(goal != null and goal.targetAmount != 0) 
  ? ((goal.savedAmount * 100) / goal.targetAmount) : 0}%|">67%</span>
        </div>

        <div class="goal-info">
          <div class="row">
            <span class="label">ëª©í‘œê¸ˆì•¡:</span>
           <span th:text="|${goal != null ? #numbers.formatInteger(goal.targetAmount,3,'COMMA') : 0}ì›|">10,000,000ì›</span>

          </div>
          <div class="row">
            <span class="label">ì €ì¶•ì•¡:</span>
            <span class="value violet"
      th:text="|${goal != null ? #numbers.formatInteger(goal.savedAmount,3,'COMMA') : 0}ì›|">7,000,000ì›</span>

          </div>
          <div class="row">
            <span class="label">ì”ì—¬ê¸ˆì•¡:</span>
           <span th:text="|${goal != null ? #numbers.formatInteger(goal.targetAmount - goal.savedAmount,3,'COMMA') : 0}ì›|">
  			3,000,000ì›
			</span>
          </div>
        </div>
      </section>

      <!-- ì¹´ë“œ: í†µê³„ + ê·¸ë˜í”„ -->
      <section class="card">
        <div class="tabs">
          <button id="tab-daily" class="tab active">ì¼ë³„ ì €ê¸ˆìœ¨</button>
          <button id="tab-monthly" class="tab">ì›”ë³„ ì €ê¸ˆìœ¨</button>
        </div>

        <div class="chart-block">
          <div class="chart-caption">0 ì› â–½</div>
          <div class="chart-wrap">
            <canvas id="savingChart"></canvas>
          </div>
          <div class="baseline"></div>
        </div>

        <div class="progress titled">
          <div class="title">ì €ê¸ˆ ì„±ê³µë¥ </div>
          <span id="successBar" style="width: 67%">67%</span>
        </div>
      </section>
    </main>
  </div>

  <!-- ì„œë²„ ê°’ JS ì£¼ì… -->
<script th:inline="javascript">
  const targetAmount = /*[[${goal != null ? goal.targetAmount : 0}]]*/ 0;
  const savedAmount  = /*[[${goal != null ? goal.savedAmount  : 0}]]*/ 0;
</script>

  <script>
    // -------- Chart.js (ì¦ì‹ ë°©ì§€ & ë†’ì´ ê³ ì •) --------
    let savingChart;

    function renderChart(labels, data) {
      const ctx = document.getElementById('savingChart').getContext('2d');
      if (savingChart) savingChart.destroy();

      savingChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'ì €ì¶•ê¸ˆì•¡',
            data,
            pointRadius: 3,
            tension: 0.35
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: { grid: { display: false } },
            y: { beginAtZero: true }
          }
        }
      });
    }

    // ìƒ˜í”Œ ë°ì´í„°(ë°±ì—”ë“œ ì—°ë™ ì „)
    const sampleDaily   = [15,12,14,18,25,22,27,26,24,28,32,31,30,29,30,33,31,35,36,34,32,33,36,35,34,37,39,38,36,37,40].map(v=>v*10000);
    const sampleMonthly = [120,130,110,150,160,170,180,190,175,185,195,210].map(v=>v*10000);

    function toDaily() {
      document.getElementById('tab-daily').classList.add('active');
      document.getElementById('tab-monthly').classList.remove('active');
      const days = new Date().getMonth() === 1 ? 28 : 31;
      renderChart(Array.from({length: days}, (_,i)=>`${i+1}ì¼`), sampleDaily.slice(0, days));
      updateSuccessBar(sampleDaily.slice(0, days));
    }
    function toMonthly() {
      document.getElementById('tab-monthly').classList.add('active');
      document.getElementById('tab-daily').classList.remove('active');
      renderChart(Array.from({length: 12}, (_,i)=>`${i+1}ì›”`), sampleMonthly);
      updateSuccessBar(sampleMonthly);
    }

    function updateSuccessBar(arr){
      const unit = Math.max(1, Math.round(targetAmount / (arr.length || 1)));
      const exceed = arr.filter(v => v >= unit).length;
      const ratio = Math.min(100, Math.round(exceed / arr.length * 100));
      const bar = document.getElementById('successBar');
      bar.style.width = ratio + '%';
      bar.textContent = ratio + '%';
    }

    document.getElementById('tab-daily').addEventListener('click', toDaily);
    document.getElementById('tab-monthly').addEventListener('click', toMonthly);

    // ì´ˆê¸° ë Œë”
    toDaily();
  </script>
</body>
</html>
