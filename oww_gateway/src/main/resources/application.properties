# ========================================
# Gateway 기본 설정
# ========================================
server.port=8201
spring.application.name=gateway-service

# ========================================
# Eureka 설정 - 호스트명 문제 해결
# ========================================
eureka.client.service-url.defaultZone=http://localhost:8200/eureka/
eureka.client.fetch-registry=true
eureka.client.register-with-eureka=true

# 중요: 호스트명을 localhost로 강제 설정
eureka.instance.hostname=localhost
eureka.instance.prefer-ip-address=false

# Gateway 자체 서비스 URL을 localhost로 강제 설정
eureka.instance.home-page-url=http://localhost:8201/
eureka.instance.status-page-url=http://localhost:8201/actuator/info
eureka.instance.health-check-url=http://localhost:8201/actuator/health

# Gateway Discovery 설정
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ========================================
# Spring Cloud Gateway 라우팅 설정
# ========================================

# 1. OAuth2 인증 시작 라우팅 (Gateway -> Login Service)
spring.cloud.gateway.routes[0].id=oauth2-login
spring.cloud.gateway.routes[0].uri=lb://login-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/oauth2/authorization/**

# 2. OAuth2 콜백 라우팅 (Login Service에서 처리)
spring.cloud.gateway.routes[1].id=oauth2-callback
spring.cloud.gateway.routes[1].uri=lb://login-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/login/oauth2/**

# 3. OAuth2 성공/실패 라우팅
spring.cloud.gateway.routes[2].id=oauth2-result
spring.cloud.gateway.routes[2].uri=lb://login-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/oauth2/success,/oauth2/failure

# 4. 메인 페이지 (Banking Service) - 정적 리소스 포함
spring.cloud.gateway.routes[3].id=main-page
spring.cloud.gateway.routes[3].uri=lb://BANKING-SERVICE
spring.cloud.gateway.routes[3].predicates[0]=Path=/,/main,/index.html,/css/**,/js/**,/img/**

# 5. Banking Service API 라우팅 - JWT 인증 필요
spring.cloud.gateway.routes[4].id=banking-api
spring.cloud.gateway.routes[4].uri=lb://BANKING-SERVICE
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/**
spring.cloud.gateway.routes[4].filters[0]=JwtAuth

# 6. Banking Service 페이지 라우팅 - JWT 인증 필요
spring.cloud.gateway.routes[5].id=banking-pages
spring.cloud.gateway.routes[5].uri=lb://BANKING-SERVICE
spring.cloud.gateway.routes[5].predicates[0]=Path=/banking/**,/account/**,/createAccount/**,/transfer/**
spring.cloud.gateway.routes[5].filters[0]=JwtAuth

# 7. MyPage Service - JWT 인증 필요 (향후 추가)
spring.cloud.gateway.routes[6].id=mypage-service
spring.cloud.gateway.routes[6].uri=lb://MYPAGE-SERVICE
spring.cloud.gateway.routes[6].predicates[0]=Path=/mypage/**
spring.cloud.gateway.routes[6].filters[0]=JwtAuth

# ========================================
# JWT 및 기타 설정
# ========================================
# JWT 설정 (Login Service와 동일해야 함)
jwt.secret=myBankingSecretKey123456789012345678901234567890
jwt.expiration=86400000
jwt.refresh-expiration=604800000

# ========================================
# CORS 설정
# ========================================
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=http://localhost:8201,http://localhost:3000
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true

# ========================================
# 호스트명 및 포트 강제 설정
# ========================================
server.forward-headers-strategy=framework
spring.cloud.gateway.x-forwarded.enabled=true
spring.cloud.gateway.x-forwarded.for-enabled=true
spring.cloud.gateway.x-forwarded.host-enabled=true
spring.cloud.gateway.x-forwarded.port-enabled=true
spring.cloud.gateway.x-forwarded.proto-enabled=true

# ========================================
# 디버깅 로그 설정
# ========================================
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.com.netflix.eureka=DEBUG
logging.level.com.netflix.discovery=DEBUG


# Actuator 설정
management.endpoints.web.exposure.include=health,info,gateway
management.endpoint.health.show-details=always