<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${mode=='edit'} ? '상품 수정' : '상품 등록'"></title>
  <link rel="stylesheet" th:href="@{/css/admin-products.css}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<!-- 사이드바 -->
<aside th:replace="fragments/admin-sidebar :: sidebar (~{::#sb})"
       id="sb" th:with="active='product'"></aside>
<div th:fragment="header">
    <!-- 헤더 내용 -->
</div>

<div th:fragment="footer">
    <!-- 푸터 내용 -->
</div>


<div th:fragment="nav">
    
</div>

<main class="form-container">
  <h1 class="page-title" th:text="${mode=='edit'} ? '상품 수정' : '상품 등록'"></h1>

  <!-- 알림/에러 메시지 -->
  <div class="alert" th:if="${msg}" th:text="${msg}"></div>

  <!-- form action: 등록 or 수정 -->
  <form th:object="${dto}"
        th:action="${mode=='edit'} ? @{|/admin/products/${dto.productNo}|} : @{/admin/products}"
        method="post" enctype="multipart/form-data" class="form">

    <!-- (선택) Spring Security CSRF -->
    <input type="hidden" th:if="${_csrf != null}"
           th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <!-- 편집 모드일 때 PK 전달 -->
    <input type="hidden" th:if="${mode=='edit'}" th:field="*{productNo}"/>

    <!-- 카테고리 -->
    <div class="form-group">
      <label for="category">카테고리 <span class="req">*</span></label>
      <select id="category" th:field="*{category}" required>
        <option value="" disabled>선택하세요</option>
        <option value="0">웨딩홀</option>
        <option value="1">스튜디오</option>
        <option value="2">드레스</option>
        <option value="3">메이크업</option>
      </select>
      <small class="help">패키지 구성에 사용될 분류입니다.</small>
    </div>

    <!-- 상품명 -->
    <div class="form-group">
      <label for="productName">상품명 <span class="req">*</span></label>
      <input id="productName" type="text" th:field="*{productName}"
             maxlength="20" placeholder="예: 웨딩홀A" required/>
      <small class="help">최대 20자 (DB 제약)</small>
    </div>

    <!-- 가격 -->
    <div class="form-group">
      <label for="cost">가격 <span class="req">*</span></label>
      <input id="cost" type="number" th:field="*{cost}" min="0" step="1"
             placeholder="원 단위 정수" required/>
    </div>

    <!-- 주소 -->
    <div class="form-group">
      <label for="address">지역/주소 <span class="req">*</span></label>
      <input id="address" type="text" th:field="*{address}" maxlength="60"
             placeholder="예: 서울 강남구 ..." required/>
      <small class="help">최대 60자 (DB 제약)</small>
    </div>

    <!-- 대표 이미지 -->
    <div class="form-group">
      <label for="file">대표 이미지</label>
      <input id="file" type="file" name="file" accept="image/*"/>
      <div class="preview" style="margin-top:8px;">
        <img id="thumbPreview"
             th:if="*{img} != null"
             th:src="*{img}"
             alt="미리보기"
             style="max-width:160px;border-radius:8px;display:block;">
      </div>
      <small class="help">jpg/png 권장. 업로드 시 기존 이미지는 대체됩니다.</small>
    </div>

    <!-- 설명 -->
    <div class="form-group">
      <label for="description">설명</label>
      <textarea id="description" th:field="*{description}" rows="5"
                maxlength="200" placeholder="상품 특징/조건 등을 입력"></textarea>
      <small class="help">최대 200자 (DB 제약)</small>
    </div>

    <!-- 버튼 -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary"
              th:text="${mode=='edit'} ? '수정 완료' : '등록'"></button>
      <a th:href="@{/admin/products}" class="btn">목록</a>
    </div>
  </form>
</main>

<!-- 이미지 미리보기 스크립트 -->
<script>
  (function () {
    const fileInput = document.getElementById('file');
    const previewImg = document.getElementById('thumbPreview');
    if (!fileInput) return;

    fileInput.addEventListener('change', function (e) {
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = function (ev) {
        if (previewImg) {
          previewImg.src = ev.target.result;
          previewImg.style.display = 'block';
        } else {
          const img = document.createElement('img');
          img.id = 'thumbPreview';
          img.style.maxWidth = '160px';
          img.style.borderRadius = '8px';
          img.alt = '미리보기';
          img.src = ev.target.result;
          document.querySelector('.preview').appendChild(img);
        }
      }
      reader.readAsDataURL(f);
    });
  })();
</script>

</body>
</html>
