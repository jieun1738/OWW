<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
  <title layout:fragment="title">메인</title>
  <!-- 이 폰트/스타일이 base.html에 이미 있다면 중복 로드하지 말고 제거 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/modal.css}">
  <!-- Swiper CSS (base에 있으면 제거) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
</head>
<body>
<section layout:fragment="content">
  <div class="container">

    <!-- ===== 헤더 ===== -->
    <header>
      <h1 class="logo">Own Wedding Wallet</h1>
      <div class="auth-section">
        <div id="logged-out-section" style="display:none;">
          <button onclick="login()" class="login-btn">로그인</button>
        </div>
        <div id="logged-in-section" style="display:none;">
          <span id="user-name-header">사용자님</span>
          <button onclick="logout()" class="logout-btn">로그아웃</button>
        </div>
      </div>
    </header>

    <!-- ===== 내비게이션 ===== -->
    <nav>
      <div class="nav-item">
        <a href="/banking/main" class="nav-link banking-btn"
           data-url="http://localhost:8201/banking/main"
           data-redirect="/banking/main">뱅킹서비스</a>
        <div class="dropdown">
          <a href="/banking/createAccount" class="banking-btn"
             data-url="http://localhost:8201/banking/createAccount"
             data-redirect="/banking/createAccount">계좌생성</a>
          <a href="/banking/transfer_1" class="banking-btn"
             data-url="http://localhost:8201/banking/transfer_1"
             data-redirect="/banking/transfer_1">이체</a>
          <a href="/banking/safebox/main" class="banking-btn"
             data-url="http://localhost:8201/banking/safebox/main"
             data-redirect="/banking/safebox/main">세이프박스</a>
        </div>
      </div>
      <div class="nav-item">
        <a href="#wedding" class="nav-link">웨딩플래너</a>
        <div class="dropdown">
          <a href="#">추천테마</a>
          <a href="#">DIY</a>
        </div>
      </div>
      <div class="nav-item">
        <a href="#loan" class="nav-link">대출</a>
        <div class="dropdown">
          <a href="#">대출상품</a>
          <a href="#">대출상환</a>
        </div>
      </div>
      <div class="nav-item">
        <a href="#mypage" class="nav-link">마이페이지</a>
      </div>
    </nav>

    <!-- ===== Hero Swiper ===== -->
    <section class="swiper hero-swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide hero" style="background-image:url('/img/wedding-1.jpg')">
          <div class="hero-content">
            <h2>당신만을 위한 럭셔리 웨딩 플랜</h2>
            <p>섬세한 맞춤 설계와 품격 있는 구성으로 인생 최고의 날을 디자인합니다.</p>
          </div>
        </div>
        <div class="swiper-slide hero" style="background-image:url('/img/wedding-2.jpg')">
          <div class="hero-content">
            <h2>맞춤형 예산 설계</h2>
            <p>당신의 예산에 맞춘 효율적인 웨딩 준비를 도와드립니다.</p>
          </div>
        </div>
        <div class="swiper-slide hero" style="background-image:url('/img/wedding-3.jpg')">
          <div class="hero-content">
            <h2>전문가의 추천 패키지</h2>
            <p>스타일별 추천을 통해 쉽고 빠르게 결정할 수 있어요.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== 서비스 소개 카드 ===== -->
    <section class="cards">
      <div class="card">
        <h3>뱅킹 서비스</h3>
        <p>이체와 거래내역, 그리고 편리한 세이프박스로 결혼자금을 안정적으로 관리하세요.</p>
      </div>
      <div class="card">
        <h3>맞춤형 웨딩 패키지</h3>
        <p>원하는 스타일과 구성으로 당신만의 웨딩을 완성할 수 있는 다양한 패키지를 제공합니다.</p>
      </div>
      <div class="card">
        <h3>대출</h3>
        <p>여러 은행의 대출 상품을 한눈에 비교하고, 최적의 조건으로 결혼 준비를 도와드립니다.</p>
      </div>
      <div class="card">
        <h3>마이페이지</h3>
        <p>예산 상태, 결제 이력, 관심 패키지 등을 한눈에 확인할 수 있는 나만의 웨딩 관리 공간입니다.</p>
      </div>
    </section>

    <!-- ===== 로그인 유도 / 로그인 후 카드 ===== -->
    <section id="login-notice" class="login-notice" style="display:none;">
      <div class="notice-card">
        <h2>🔒 로그인이 필요합니다</h2>
        <p>Own Wedding Wallet의 모든 서비스를 이용하시려면 먼저 로그인해주세요.</p>
        <button onclick="login()" class="big-login-btn">Google로 로그인하기</button>
      </div>
    </section>

    <section id="service-cards" class="service-cards" style="display:none;">
      <article class="service-card">
        <div class="service-card-left">
          <h1><span id="user-name-display">사용자</span>님의 통장</h1>
          <h2 id="account-number">계좌 정보 로딩중...</h2>
          <div class="balance-text">잔액: <span class="balance-amount">로딩중...</span></div>
        </div>
        <div class="service-card-right">
          <button class="history-btn banking-btn"
                  data-url="http://localhost:8201/banking/transfer_1"
                  data-redirect="/banking/transfer_1">이체하기</button>
          <button class="history-btn" onclick="alert('내역조회 준비중')">내역조회</button>
        </div>
      </article>

      <article class="service-card">
        <div class="service-card-left">
          <h1><span id="user-name-display2">사용자</span>님의 세이프박스</h1>
          <div class="balance-text">잔액: <span class="balance-amount">로딩중...</span></div>
        </div>
        <div class="service-card-right">
          <button class="history-btn banking-btn"
                  data-url="http://localhost:8201/banking/safebox"
                  data-redirect="/banking/safebox">관리하기</button>
        </div>
      </article>
    </section>

    <footer>&copy; 2025 Own Wedding Wallet. All rights reserved.</footer>
  </div>

  <!-- ===== Welcome Modal ===== -->
  <div id="welcome-modal" class="welcome-modal" style="display:none;">
    <div class="modal-content">
      <h2>🎉 환영합니다!</h2>
      <p><span id="modal-user-name">사용자</span>님, Own Wedding Wallet에 오신 것을 환영합니다.</p>
      <button onclick="closeWelcomeModal()">시작하기</button>
    </div>
  </div>
</section>

<!-- 페이지 전용 스크립트 -->
<th:block layout:fragment="scripts">
  <!-- Swiper JS (base에 있으면 제거) -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>

  <script th:src="@{/js/account.js}"></script>
  <script th:src="@{/js/auth.js}"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // Swiper
      if (window.Swiper) {
        new Swiper('.hero-swiper', {
          autoplay: { delay: 4000, disableOnInteraction: false },
          loop: true
        });
      }

      // 로그인 토글 (auth.js에 isLoggedIn(), getUserName()이 있다고 가정)
      try {
        const outSec = document.getElementById('logged-out-section');
        const inSec  = document.getElementById('logged-in-section');
        const loginNotice = document.getElementById('login-notice');
        const svcCards = document.getElementById('service-cards');

        const loggedIn = typeof isLoggedIn === 'function' ? isLoggedIn() : false;
        if (loggedIn) {
          const name = typeof getUserName === 'function' ? (getUserName() || '사용자') : '사용자';
          document.getElementById('user-name-header').textContent = name;
          document.getElementById('user-name-display').textContent = name;
          document.getElementById('user-name-display2').textContent = name;
          document.getElementById('modal-user-name').textContent = name;

          outSec.style.display = 'none';
          inSec.style.display = 'flex';
          loginNotice.style.display = 'none';
          svcCards.style.display = 'block';

          // 첫 방문 환영 모달 (auth.js에서 조건 관리 가능)
          if (typeof shouldShowWelcome === 'function' ? shouldShowWelcome() : false) {
            document.getElementById('welcome-modal').style.display = 'block';
          }
        } else {
          outSec.style.display = 'block';
          inSec.style.display = 'none';
          loginNotice.style.display = 'block';
          svcCards.style.display = 'none';
        }
      } catch (e) {
        console.warn('auth toggle error:', e);
      }

      // 뱅킹 버튼 클릭 핸들링 (게이트웨이 → 리다이렉트)
      document.querySelectorAll('.banking-btn').forEach(btn => {
        btn.addEventListener('click', function(ev){
          // a 기본 동작 유지하려면 아래 두 줄 주석
          ev.preventDefault();
          const url = this.dataset.url;
          const redirect = this.dataset.redirect || this.getAttribute('href');
          // 필요 시 게이트웨이 핸드셰이크 후 redirect
          if (url) {
            window.location.href = redirect || url;
          } else if (redirect) {
            window.location.href = redirect;
          }
        });
      });
    });

    function closeWelcomeModal() {
      const m = document.getElementById('welcome-modal');
      if (m) m.style.display = 'none';
      if (typeof markWelcomeSeen === 'function') markWelcomeSeen();
    }
  </script>
</th:block>
</body>
</html>
