<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
  <title layout:fragment="title">WeddingDIY</title>
  <link rel="stylesheet" th:href="@{/css/WeddingDIY.css}">
</head>
<body>
<section layout:fragment="content">
  <div class="page" id="wpdiy">
    <div th:replace="~{fragments/MainSideBar :: sidebar(user=${user}, active='WeddingPlanner/WeddingDIY', progress=${progressPercent})}"></div>

    <main class="main">
      <h1 class="brown-title section-title"><i class='bx bx-wrench'></i>Wedding DIY</h1>
      <p class="brown-desc">스튜디오 · 드레스 · 메이크업 · 웨딩홀을 비교·선택해 나만의 플랜을 구성하세요.</p>

      <div class="folder">
        <div class="folder-tabs" role="tablist" aria-label="카테고리">
          <a class="tab" th:classappend="${cat == 1 and !all} ? ' active' : ''"
             th:href="@{/planner/diy(cat=1, q=${q}, sort=${sort})}">
            <i class='bx bx-camera'></i> 스튜디오
          </a>
          <a class="tab" th:classappend="${cat == 2 and !all} ? ' active' : ''"
             th:href="@{/planner/diy(cat=2, q=${q}, sort=${sort})}">
            <i class='bx bx-female'></i> 드레스
          </a>
          <a class="tab" th:classappend="${cat == 3 and !all} ? ' active' : ''"
             th:href="@{/planner/diy(cat=3, q=${q}, sort=${sort})}">
            <i class='bx bx-brush'></i> 메이크업
          </a>
          <a class="tab" th:classappend="${cat == 0 and !all} ? ' active' : ''"
             th:href="@{/planner/diy(cat=0, q=${q}, sort=${sort})}">
            <i class='bx bx-buildings'></i> 웨딩홀
          </a>
          <a class="tab" th:classappend="${all} ? ' active' : ''"
             th:href="@{/planner/diy(all=true, q=${q}, sort=${sort})}">
            <i class='bx bx-grid-alt'></i> 전체보기
          </a>
        </div>

        <div class="folder-body">
          <section class="toolbar" role="search">
            <form class="searchbar" method="get" th:action="@{/planner/diy}">
              <i class='bx bx-search' aria-hidden="true"></i>
              <input type="hidden" name="all" th:value="${all}" th:if="${all}">
              <input type="hidden" name="cat" th:value="${cat}" th:if="${!all}">
              <input type="search" name="q" th:value="${q}" placeholder="검색어를 입력하세요"/>
              <button class="btn-s" type="button" onclick="this.form.q.value=''; this.form.submit()"><i class='bx bx-eraser'></i> 지우기</button>
            </form>

            <div class="chipbox" aria-label="빠른 정렬">
              <a class="chip" th:classappend="${sort == 'cost_asc'} ? ' active' : ''"
                 th:if="${!all}" th:href="@{/planner/diy(cat=${cat}, q=${q}, sort='cost_asc')}"><i class='bx bx-sort-up'></i> 가격순</a>
              <a class="chip" th:classappend="${sort == 'cost_desc'} ? ' active' : ''"
                 th:if="${!all}" th:href="@{/planner/diy(cat=${cat}, q=${q}, sort='cost_desc')}"><i class='bx bx-sort-down'></i> 가격순</a>

              <a class="chip" th:classappend="${sort == 'cost_asc'} ? ' active' : ''"
                 th:if="${all}" th:href="@{/planner/diy(all=true, q=${q}, sort='cost_asc')}"><i class='bx bx-sort-up'></i> 가격순</a>
              <a class="chip" th:classappend="${sort == 'cost_desc'} ? ' active' : ''"
                 th:if="${all}" th:href="@{/planner/diy(all=true, q=${q}, sort='cost_desc')}"><i class='bx bx-sort-down'></i> 가격순</a>
            </div>
          </section>

          <section class="filter-advanced">
            <details open>
              <summary><i class='bx bx-filter-alt'></i> 카테고리 선택</summary>
              <div class="fa-inner">
                <div class="fa-row">
                  <div class="fa-label">카테고리</div>
                  <div class="fa-fields">
                    <label class="chk" th:if="${all}">
                      <span class="icon-box --sm"><i class='bx bx-grid-alt'></i></span>
                      <input type="checkbox" checked disabled> 현재 선택: 전체
                    </label>
                    <label class="chk" th:if="${!all}">
                      <span class="icon-box --sm"><i class='bx bx-category'></i></span>
                      <input type="checkbox" checked disabled>
                      현재 선택:
                      <span th:text="${cat == 0 ? '웨딩홀' : (cat==1 ? '스튜디오' : (cat==2 ? '드레스' : '메이크업'))}">스튜디오</span>
                    </label>
                  </div>
                </div>
                <div class="fa-row">
                  <div class="fa-label">제외할 단어</div>
                  <div class="fa-fields">
                    <span class="icon-box --sm"><i class='bx bx-minus-back'></i></span>
                    <input type="text" class="input fa-exclude" placeholder="예: 야외, 스냅 불가, 주차 협소" disabled>
                    <button class="btn-s" type="button" disabled><i class='bx bx-filter-alt'></i> 적용</button>
                  </div>
                </div>
              </div>
            </details>
          </section>

          <section class="grid" aria-live="polite">
            <article class="card" th:each="p : ${products}">
              <div class="thumb"
                   th:style="|background-image:url(${#strings.containsIgnoreCase(p.img,'http') ? p.img : @{/img/{img}(img=${p.img})}}); background-size:cover; background-position:center;|"></div>
              <div class="content">
                <h3 class="title"><span class="icon-box brand --sm"><i class='bx bx-image-alt'></i></span>
                  <span th:text="${p.productName}">상품명</span>
                </h3>
                <div class="meta-row">
                  <span><i class='bx bx-won'></i>
                    <span th:text="${#numbers.formatInteger(p.cost, 3, 'COMMA') + '원'}">0원</span>
                  </span>
                  <span>•</span>
                  <span><i class='bx bx-map'></i> <span th:text="${p.address}">주소</span></span>
                </div>
              </div>
              <div class="row-actions">
                <form th:action="@{/planner/compare/product/add}" method="post">
                  <input type="hidden" name="productNo" th:value="${p.productNo}">
                  <button class="btn-m" type="submit"><i class='bx bx-git-compare'></i> 비교</button>
                </form>
                <form th:action="@{/planner/draft/item}" method="post">
                  <input type="hidden" name="productNo" th:value="${p.productNo}">
                  <button class="btn-m contained" type="submit"><i class='bx bx-check-circle'></i> 선택</button>
                </form>
              </div>
            </article>

            <div class="empty" th:if="${#lists.isEmpty(products)}"><i class='bx bx-info-circle'></i> 검색 결과가 없습니다.</div>
          </section>
        </div>
      </div>
    </main>

    <aside class="selectbar" aria-label="선택 현황 패널">
      <div class="row" style="padding-top:2px; gap:12px">
        <div class="sb-title">
          <span class="icon-box brand --sm"><i class='bx bx-basket'></i></span> 선택 현황
          <span class="pill" style="margin-left:8px"
                th:text="${#lists.isEmpty(selectedItems) ? '선택 없음' : '선택 ' + selectedItems.size() + '건'}">선택 없음</span>
        </div>
        <div style="margin-left:auto; display:flex; align-items:center; gap:8px">
          <form th:action="@{/planner/draft/reset}" method="post">
            <button class="btn-s" type="submit"><i class='bx bx-reset'></i> 모두 초기화</button>
          </form>
        </div>
      </div>

      <section class="sb-block" th:if="${selectedPlan != null}">
        <div class="row">
          <strong><i class='bx bx-file'></i>
            <span th:text="${selectedPlan.planNo != null ? selectedPlan.planNo + '번 플랜' : '임시 플랜'}">임시 플랜</span>
          </strong>
        </div>

        <div class="mini" th:each="it : ${selectedItems}" style="position:relative">
          <div class="thumb-s"
               th:style="|background-image:url(${#strings.containsIgnoreCase(it.img,'http') ? it.img : @{/img/{img}(img=${it.img})}}); background-size:cover; background-position:center;|">
          </div>
          <div class="meta">
            <div th:text="${it.productName}">상품명</div>
            <div class="tag" th:text="${it.categoryName}">카테고리</div>
          </div>
          <div class="price" th:text="${#numbers.formatInteger(it.cost, 3, 'COMMA') + '원'}">0원</div>

          <form th:action="@{/planner/draft/item/delete}" method="post"
                style="position:absolute; top:6px; right:6px; line-height:1;">
            <input type="hidden" name="category" th:value="${it.category}">
            <button title="항목 삭제" class="btn-s" type="submit"><i class='bx bx-x'></i></button>
          </form>
        </div>

        <div class="row" style="margin-top:8px">
          <div class="legend">
            <span class="dot ok"></span> 예산 이내
            <span class="dot ng" style="margin-left:10px"></span> 예산 초과
          </div>
          <div class="budget" th:classappend="${isBudgetOk} ? ' ok' : ' ng'"
               th:text="${isBudgetOk ? '예산 이내' : '예산 초과'}">예산 이내</div>
        </div>
        <div class="row" style="padding-top:0">
          <div class="tag"><i class='bx bx-calculator'></i> 합계</div>
          <div class="price" th:text="${#numbers.formatInteger(selectedTotal, 3, 'COMMA') + '원'}">0원</div>
        </div>
      </section>

      <section class="sb-block" th:if="${selectedPlan == null}">
        <div class="row"><strong><i class='bx bx-info-circle'></i> 플랜 없음</strong></div>
        <div class="empty">선택한 상품이 없습니다.</div>
        <div class="row" style="padding-top:0">
          <div class="tag"><i class='bx bx-calculator'></i> 합계</div>
          <div class="price">0원</div>
        </div>
      </section>

      <section class="sb-block">
        <div class="row" style="justify-content:flex-start; gap:8px">
          <form th:action="@{/planner/draft/save}" method="post"><button class="btn" type="submit"><i class='bx bx-save'></i> 플랜 저장</button></form>
          <form th:action="@{/planner/draft/load}" method="post"><button class="btn" type="submit"><i class='bx bx-upload'></i> 플랜 불러오기</button></form>
          <form th:action="@{/planner/draft/new}" method="post"><button class="btn" type="submit"><i class='bx bx-plus-circle'></i> 플랜 추가</button></form>
        </div>
      </section>

      <section class="sb-block" th:if="${selectedItems != null && !#lists.isEmpty(selectedItems)}">
        <div class="row" style="gap:8px; justify-content:flex-start">
          <a class="btn primary" th:href="@{/planner/confirm}"><i class='bx bx-badge-check'></i> 확정하기</a>
          <a class="btn" th:href="@{/planner/compare/product}" th:text="'비교보기(' + ${compareCount} + ')'"><i class='bx bx-git-compare'></i> 비교보기</a>
        </div>
      </section>
    </aside>
  </div>
</section>
</body>
</html>
