# Gateway 기본 설정
server.port=8201
spring.application.name=gateway-service

# Security 비활성화 (Gateway는 라우터 역할만)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration

# Eureka 설정
eureka.client.service-url.defaultZone=http://localhost:8200/eureka/
eureka.client.fetch-registry=true
eureka.client.register-with-eureka=true

# JWT 설정 (Login Service와 동일하게)
jwt.secret=myBankingSecretKey123456789012345678901234567890
jwt.expiration=86400000
jwt.refresh-expiration=604800000

# Spring Cloud Gateway 라우팅 설정

# 1. 정적 파일 라우팅 (Banking Service에서 가져오기 - 최우선 순위)
spring.cloud.gateway.routes[0].id=banking-static
spring.cloud.gateway.routes[0].uri=lb://banking-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/css/**,/js/**,/images/**

# 2. 인증 관련 (Login Service) - 인증 필터 없음
spring.cloud.gateway.routes[1].id=auth-service
spring.cloud.gateway.routes[1].uri=lb://LOGIN-SERVICE
spring.cloud.gateway.routes[1].predicates[0]=Path=/auth/**,/login/**,/oauth2/**
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/auth/(?<segment>.*), /$\{segment}

# 3. Banking Service API 라우팅 - ✅ JWT 인증 필터 순서 변경
spring.cloud.gateway.routes[2].id=banking-api
spring.cloud.gateway.routes[2].uri=lb://banking-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/banking/**
spring.cloud.gateway.routes[2].filters[0]=JwtAuthenticationFilter # <-- 순서 변경
spring.cloud.gateway.routes[2].filters[1]=RewritePath=/api/banking/(?<segment>.*), /$\{segment}

# 4. Banking Service 직접 접근 - ✅ JWT 인증 필터 순서 변경
spring.cloud.gateway.routes[3].id=banking-direct
spring.cloud.gateway.routes[3].uri=lb://banking-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/banking/**
spring.cloud.gateway.routes[3].filters[0]=JwtAuthenticationFilter # <-- 순서 변경
spring.cloud.gateway.routes[3].filters[1]=RewritePath=/banking/(?<segment>.*), /$\{segment}

# 5. MyPage Service (나중에 추가) - ✅ JWT 인증 필터 순서 변경
spring.cloud.gateway.routes[4].id=mypage-service
spring.cloud.gateway.routes[4].uri=lb://MYPAGE-SERVICE
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/mypage/**
spring.cloud.gateway.routes[4].filters[0]=JwtAuthenticationFilter # <-- 순서 변경
spring.cloud.gateway.routes[4].filters[1]=RewritePath=/api/mypage/(?<segment>.*), /$\{segment}

# 로깅 설정
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.web=DEBUG
