<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Own Wedding Wallet</title>
<link rel="stylesheet" href="/css/main.css" />
<style>
/* í™˜ì˜ ëª¨ë‹¬ ì „ì²´ */
.welcome-modal {
	display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.5);
	justify-content: center; /* ì¤‘ì•™ì •ë ¬ */
	align-items: center; /* ì¤‘ì•™ì •ë ¬ */
	z-index: 2000; /* ìµœìƒë‹¨ */
	text-align: center;
}

/* ëª¨ë‹¬ ë³´ì´ê¸° */
.welcome-modal.show {
	display: flex;
}

/* ëª¨ë‹¬ ë°•ìŠ¤ */
.welcome-modal .modal-content {
	background: #fff;
	padding: 40px;
	border-radius: 20px;
	box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
	max-width: 400px;
	width: 90%;
	text-align: center;
	font-family: 'Noto Sans KR', 'Segoe UI', sans-serif; /* í•œê¸€ í°íŠ¸ */
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.welcome-modal .modal-content button {
	margin-top: 20px;
	padding: 12px 30px;
	background: #ff726f; /* main.css ë²„íŠ¼ ìƒ‰ìƒê³¼ í†µì¼ */
	color: #fff;
	border: none;
	border-radius: 20px;
	cursor: pointer;
	font-weight: 600;
	transition: all 0.3s ease;
}

.welcome-modal .modal-content button:hover {
	background: #ff5a57;
	transform: translateY(-2px);
	box-shadow: 0 5px 15px rgba(255, 114, 111, 0.3);
}
</style>
</head>
<body>
	<div class="container">
		<header>
			<h1 class="logo">Own Wedding Wallet</h1>
			<div class="auth-section">
				<div id="logged-out-section" style="display: none;">
					<button onclick="login()" class="login-btn">ë¡œê·¸ì¸</button>
				</div>
				<div id="logged-in-section" style="display: none;">
					<span id="user-name-header">ì‚¬ìš©ìë‹˜</span>
					<button onclick="logout()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
				</div>
			</div>
		</header>

		<nav>
			<div class="nav-item">
				<a href="/banking/banking_main" class="nav-link">ë±…í‚¹ì„œë¹„ìŠ¤</a>
				<div class="dropdown">
					<a href="/banking/banking_createAccount">ê³„ì¢Œìƒì„±</a> <a
						href="/banking/banking_transfer_1">ì´ì²´</a> <a
						href="/banking/banking_safebox">ì„¸ì´í”„ë°•ìŠ¤</a>
				</div>
			</div>
			<div class="nav-item">
				<a href="#wedding" class="nav-link">ì›¨ë”©í”Œë˜ë„ˆ</a>
				<div class="dropdown">
					<a href="#">ì¶”ì²œí…Œë§ˆ</a> <a href="#">DIY</a>
				</div>
			</div>
			<div class="nav-item">
				<a href="#loan" class="nav-link">ëŒ€ì¶œ</a>
				<div class="dropdown">
					<a href="#">ëŒ€ì¶œìƒí’ˆ</a> <a href="#">ëŒ€ì¶œìƒí™˜</a>
				</div>
			</div>
			<div class="nav-item">
				<a href="#mypage" class="nav-link">ë§ˆì´í˜ì´ì§€</a>
			</div>
		</nav>

		<section id="login-notice" class="login-notice" style="display: none;">
			<div class="notice-card">
				<h2>ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
				<p>Own Wedding Walletì˜ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹œë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
				<button onclick="login()" class="big-login-btn">Googleë¡œ
					ë¡œê·¸ì¸í•˜ê¸°</button>
			</div>
		</section>

		<section id="service-cards" class="service-cards"
			style="display: none;">
			<article class="service-card">
				<div class="service-card-left">
					<h1>
						<span id="user-name-display">ì‚¬ìš©ì</span>ë‹˜ì˜ í†µì¥
					</h1>
					<h2>123-4567-89012</h2>
					<div class="balance-text">
						ì”ì•¡: <span class="balance-amount">â‚©1,234,567</span>
					</div>
					<h3>
						ì´ë©”ì¼: <span id="user-email-display">user@example.com</span>
					</h3>
				</div>

				<div class="service-card-right">
					<button class="history-btn"
						onclick="location.href='/banking/banking_transfer_1'">ì´ì²´í•˜ê¸°</button>
					<button class="history-btn" onclick="alert('ë‚´ì—­ì¡°íšŒ ì¤€ë¹„ì¤‘')">ë‚´ì—­ì¡°íšŒ</button>
				</div>
			</article>

			<article class="service-card">
				<div class="service-card-left">
					<h1>
						<span id="user-name-display2">ì‚¬ìš©ì</span>ë‹˜ì˜ ì„¸ì´í”„ë°•ìŠ¤
					</h1>
					<div class="balance-text">
						ì”ì•¡: <span class="balance-amount">â‚©5,000,000</span>
					</div>
				</div>
				<div class="service-card-right">
					<button class="history-btn"
						onclick="location.href='/banking/banking_safebox'">ê´€ë¦¬í•˜ê¸°</button>
				</div>
			</article>
		</section>

		<footer>&copy; 2025 Own Wedding Wallet. All rights reserved.</footer>
	</div>

	<div id="welcome-modal" class="welcome-modal">
		<div class="modal-content">
			<h2>ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
			<p>
				<span id="modal-user-name">ì‚¬ìš©ì</span>ë‹˜, Own Wedding Walletì— ì˜¤ì‹  ê²ƒì„
				í™˜ì˜í•©ë‹ˆë‹¤.
			</p>
			<button onclick="closeWelcomeModal()">ì‹œì‘í•˜ê¸°</button>
		</div>
	</div>

	<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    window.onload = function() { checkLoginStatus(); };

    function checkLoginStatus() {
        const urlParams = new URLSearchParams(window.location.search);
        const loginSuccess = urlParams.get('login');

        if (loginSuccess) window.history.replaceState({}, document.title, window.location.pathname);

        const token = getCookie('jwt-token');
        if (token) {
            showLoggedInState();
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const userName = payload.name || payload.username || 'ì‚¬ìš©ì';
                const userEmail = payload.email || payload.sub || 'user@example.com';
                updateUserInfo(userName, userEmail);
                if (loginSuccess === 'success') showWelcomeModal(userName);
            } catch(e) {
                console.error('JWT íŒŒì‹± ì˜¤ë¥˜:', e);
                updateUserInfo('ì‚¬ìš©ì', 'user@example.com');
            }
        } else {
            showLoggedOutState();
        }
    }

    function updateUserInfo(userName, userEmail) {
        document.getElementById('user-name-header').textContent = userName + 'ë‹˜';
        document.getElementById('user-name-display').textContent = userName;
        document.getElementById('user-name-display2').textContent = userName;
        document.getElementById('user-email-display').textContent = userEmail;
        document.getElementById('modal-user-name').textContent = userName;
    }

    function showLoggedInState() {
        document.getElementById('logged-out-section').style.display = 'none';
        document.getElementById('logged-in-section').style.display = 'flex';
        document.getElementById('login-notice').style.display = 'none';
        document.getElementById('service-cards').style.display = 'flex';
    }

    function showLoggedOutState() {
        document.getElementById('logged-out-section').style.display = 'block';
        document.getElementById('logged-in-section').style.display = 'none';
        document.getElementById('login-notice').style.display = 'block';
        document.getElementById('service-cards').style.display = 'none';
    }

    function showWelcomeModal(userName) {
        const modal = document.getElementById('welcome-modal');
        modal.classList.add('show');
    }

    function closeWelcomeModal() {
        document.getElementById('welcome-modal').classList.remove('show');
    }

    function login() {
        window.location.href = '/auth/oauth2/authorization/google';
    }

    function logout() {
        deleteCookie('jwt-token');
        showLoggedOutState();
        updateUserInfo('ì‚¬ìš©ì', 'user@example.com');
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function deleteCookie(name) {
        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;';
    }
</script>
</body>
</html>
