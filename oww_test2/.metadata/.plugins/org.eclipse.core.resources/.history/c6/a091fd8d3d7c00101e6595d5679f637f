package oww.banking;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.transaction.annotation.EnableTransactionManagement;

import jakarta.mail.internet.MimeMessage;

@SpringBootApplication
@EnableTransactionManagement
@MapperScan("oww.banking.mapper")
public class BankingApplication implements CommandLineRunner {
	
	 @Autowired
	    private JavaMailSender mailSender;

    public static void main(String[] args) {
        SpringApplication.run(BankingApplication.class, args);
    }
    
    @Override
    public void run(String... args) throws Exception {
        String toEmail = "ë°›ëŠ”ì‚¬ëŒì´ë©”ì¼@gmail.com";  // í…ŒìŠ¤íŠ¸ìš©
        String fromEmail = "dudtlr5119@gmail.com";   // application.propertiesì™€ ë™ì¼
        String fromName = "Own Wedding Wallet";
        String verificationCode = "123456";          // í…ŒìŠ¤íŠ¸ ì¸ì¦ë²ˆí˜¸

        try {
            System.out.println("ğŸ“§ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ ì‹œì‘");

            MimeMessage message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

            helper.setFrom(fromEmail, fromName);
            helper.setTo(toEmail);
            helper.setSubject("[Own Wedding Wallet] ê³„ì¢Œ ê°œì„¤ ì´ë©”ì¼ ì¸ì¦");
            helper.setText("í…ŒìŠ¤íŠ¸ìš© ì¸ì¦ë²ˆí˜¸: " + verificationCode, false);

            mailSender.send(message);
            System.out.println("âœ… ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ: " + toEmail);

        } catch (Exception e) {
            System.out.println("âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    
    
}