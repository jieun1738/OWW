package oww.banking;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.transaction.annotation.EnableTransactionManagement;

import jakarta.mail.internet.MimeMessage;

@SpringBootApplication
@EnableTransactionManagement
@MapperScan("oww.banking.mapper")
public class BankingApplication implements CommandLineRunner {
	
	 @Autowired
	    private JavaMailSender mailSender;

    public static void main(String[] args) {
        SpringApplication.run(BankingApplication.class, args);
    }
    
    @Override
    public void run(String... args) throws Exception {
        String toEmail = "받는사람이메일@gmail.com";  // 테스트용
        String fromEmail = "dudtlr5119@gmail.com";   // application.properties와 동일
        String fromName = "Own Wedding Wallet";
        String verificationCode = "123456";          // 테스트 인증번호

        try {
            System.out.println("📧 이메일 테스트 시작");

            MimeMessage message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

            helper.setFrom(fromEmail, fromName);
            helper.setTo(toEmail);
            helper.setSubject("[Own Wedding Wallet] 계좌 개설 이메일 인증");
            helper.setText("테스트용 인증번호: " + verificationCode, false);

            mailSender.send(message);
            System.out.println("✅ 이메일 발송 성공: " + toEmail);

        } catch (Exception e) {
            System.out.println("❌ 이메일 발송 실패: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    
    
}