package com.oww.gateway.controller;

import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Mono;

import java.nio.charset.StandardCharsets;
import java.nio.file.Files;

@RestController
public class HomeController {

    @GetMapping(value = "/", produces = MediaType.TEXT_HTML_VALUE)
    public Mono<String> home() {
        try {
            Resource resource = new ClassPathResource("static/index.html");
            String content = Files.readString(resource.getFile().toPath(), StandardCharsets.UTF_8);
            return Mono.just(content);
        } catch (Exception e) {
            // index.html이 없으면 간단한 HTML 반환
            String html = """
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>Own Wedding Wallet</title>
                    <style>
                        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
                        .container { max-width: 600px; margin: 0 auto; }
                        .login-btn { background: #007bff; color: white; border: none; 
                                    padding: 15px 30px; font-size: 18px; border-radius: 5px; 
                                    cursor: pointer; }
                        .login-btn:hover { background: #0056b3; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>🏦 Own Wedding Wallet</h1>
                        <p>환영합니다! 로그인하여 서비스를 이용해보세요.</p>
                        <button class="login-btn" onclick="location.href='/oauth2/authorization/google'">
                            Google로 로그인
                        </button>
                        <br><br>
                        <a href="/banking_main">뱅킹 서비스 테스트</a>
                    </div>
                </body>
                </html>
                """;
            return Mono.just(html);
        }
    }

    @GetMapping("/test")
    public Mono<String> test() {
        return Mono.just("Gateway is working! 🚀");
    }
}