<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ê³„ì¢Œ ê°œì„¤</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="/css/account_css.css" />
<link rel="stylesheet" href="/css/page.css" />
<style>
body {
	display: block !important;
	justify-content: initial !important;
	align-items: initial !important;
}
.container {
	width: 600px !important;
	margin: 50px auto !important;
}
.password-box {
	cursor: pointer;
	padding: 8px;
	border: 1px solid #ccc;
	border-radius: 4px;
	text-align: center;
	user-select: none;
}
.keypad {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	gap: 8px;
	margin-top: 8px;
}
.submit-btn {
	width: 100%;
	padding: 10px;
	background-color: #4CAF50;
	color: white;
	border: none;
	border-radius: 5px;
	cursor: pointer;
}
.submit-btn:hover {
	background-color: #45a049;
}
.terms-inline {
	display: flex;
	align-items: center;
	gap: 4px;
}
.terms-link {
	color: #007bff;
	text-decoration: none;
	cursor: pointer;
}
.modal {
	display: none;
	position: fixed;
	top: 0; left: 0;
	width: 100%; height: 100%;
	background: rgba(0,0,0,0.5);
	justify-content: center; align-items: center;
}
.modal-content {
	background: white;
	padding: 20px;
	border-radius: 8px;
	width: 80%;
	max-width: 500px;
}
.close {
	float: right;
	font-size: 24px;
	cursor: pointer;
}
</style>
</head>
<body>

<header>
	<h1 class="logo">Own Wedding Wallet</h1>
</header>

<nav>
	<div class="nav-item">
		<a href="/banking/main" class="nav-link">ë±…í‚¹ì„œë¹„ìŠ¤</a>
		<div class="dropdown">
			<a href="/banking/createAccount">ê³„ì¢Œìƒì„±</a>
			<a href="/banking/transfer_1">ì´ì²´</a>
			<a href="/banking/safebox">ì„¸ì´í”„ë°•ìŠ¤</a>
		</div>
	</div>
	<div class="nav-item">
		<a href="#wedding" class="nav-link">ì›¨ë”©í”Œë˜ë„ˆ</a>
		<div class="dropdown">
			<a href="#">ì¶”ì²œí…Œë§ˆ</a>
			<a href="#">DIY</a>
		</div>
	</div>
	<div class="nav-item">
		<a href="#loan" class="nav-link">ëŒ€ì¶œ</a>
		<div class="dropdown">
			<a href="#">ëŒ€ì¶œìƒí’ˆ</a>
			<a href="#">ëŒ€ì¶œìƒí™˜</a>
		</div>
	</div>
	<div class="nav-item">
		<a href="#mypage" class="nav-link">ë§ˆì´í˜ì´ì§€</a>
	</div>
</nav>

<form action="/banking/account/create" method="post" onsubmit="return submitForm()">
<section class="container" role="main" aria-label="ê³„ì¢Œ ê°œì„¤ í¼">
	<h2>ê³„ì¢Œ ê°œì„¤</h2>

	<article class="section">
		<label for="name">ì´ë¦„</label>
		<input type="text" id="name" name="name" placeholder="í™ê¸¸ë™" autocomplete="name" required />
	</article>

	<article class="section">
		<label for="birth">ìƒë…„ì›”ì¼ (6ìë¦¬)</label>
		<input type="text" id="birth" name="birth" placeholder="950101" maxlength="6" pattern="\d{6}" title="6ìë¦¬ ìˆ«ì ì…ë ¥" autocomplete="bday" required />
	</article>

	<article class="section">
		<label for="email">ì´ë©”ì¼ ì£¼ì†Œ</label>
		<input type="email" id="email" name="email" placeholder="example@email.com" autocomplete="email" required />
	</article>

	<article class="section">
		<button type="button" onclick="sendEmailVerification(event)" style="width: 100%;">ì¸ì¦ ì´ë©”ì¼ ë°œì†¡</button>
	</article>

	<article class="section" id="emailVerifySection" style="display: none;">
		<label for="emailCode">ì¸ì¦ë²ˆí˜¸ ì…ë ¥</label>
		<input type="text" id="emailCode" name="emailCode" placeholder="6ìë¦¬ ì…ë ¥" maxlength="6" />
		<button type="button" onclick="verifyEmailCode(event)" style="margin-top: 8px; width: 100%;">âœ… ì¸ì¦ í™•ì¸</button>
	</article>

	<article class="section">
		<label for="passwordInput">ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸ (ìˆ«ì 4ìë¦¬)</label>
		<div id="passwordDisplay" class="password-box" tabindex="0" aria-label="ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½" role="textbox" aria-readonly="true" onclick="showKeypad()" onkeydown="preventTyping(event)">â— â— â— â—</div>
		<input type="hidden" id="passwordInput" name="password" maxlength="4" required />
		<div class="keypad" id="keypad" aria-label="ìˆ«ì í‚¤íŒ¨ë“œ" style="display: none;">
			<button type="button" onclick="addNumber('1')">1</button>
			<button type="button" onclick="addNumber('2')">2</button>
			<button type="button" onclick="addNumber('3')">3</button>
			<button type="button" onclick="addNumber('4')">4</button>
			<button type="button" onclick="addNumber('5')">5</button>
			<button type="button" onclick="addNumber('6')">6</button>
			<button type="button" onclick="addNumber('7')">7</button>
			<button type="button" onclick="addNumber('8')">8</button>
			<button type="button" onclick="addNumber('9')">9</button>
			<button type="button" onclick="hideKeypad()">ì·¨ì†Œ</button>
			<button type="button" onclick="addNumber('0')">0</button>
			<button type="button" onclick="removeNumber()">ì‚­ì œ</button>
		</div>
	</article>

	<article class="section">
		<div class="terms-inline">
			<input type="checkbox" id="agree" name="agree" required />
			<label for="agree">ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
			<a href="#" onclick="openModal(event)" class="terms-link">[ì•½ê´€ ë³´ê¸°]</a>
		</div>
	</article>

	<article class="section">
		<button class="submit-btn" type="submit">ê³„ì¢Œ ê°œì„¤í•˜ê¸°</button>
	</article>
</section>
</form>

<div id="termsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
	<div class="modal-content">
		<span class="close" onclick="closeModal()" aria-label="ëª¨ë‹¬ ë‹«ê¸°">&times;</span>
		<h3 id="modalTitle">ê³„ì¢Œ ê°œì„¤ ì•½ê´€</h3>
		<div id="modalDesc">
			<p>ë³¸ì¸ì€ ê³„ì¢Œ ê°œì„¤ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ì‚¬ì‹¤ëŒ€ë¡œ ì…ë ¥í•˜ì˜€ìœ¼ë©°, ì „ìê¸ˆìœµê±°ë˜ë²• ë° ê´€ë ¨ ë²•ë¥ ì— ë”°ë¼ ì œê³µë˜ëŠ” ì„œë¹„ìŠ¤ ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</p>
			<h4>ì œ1ì¡° (ëª©ì )</h4>
			<p>ë³¸ ì•½ê´€ì€ Own Wedding Walletì˜ ê³„ì¢Œ ê°œì„¤ ë° ì´ìš©ì— ê´€í•œ ì‚¬í•­ì„ ê·œì •í•©ë‹ˆë‹¤.</p>
			<h4>ì œ2ì¡° (ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©)</h4>
			<p>ê³„ì¢Œ ê°œì„¤ì„ ìœ„í•´ í•„ìš”í•œ ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ë©°, ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë©ë‹ˆë‹¤.</p>
			<h4>ì œ3ì¡° (ê³„ì¢Œ ì´ìš© ë° í•´ì§€)</h4>
			<p>ê³„ì¢ŒëŠ” ë³¸ì¸ í™•ì¸ í›„ ì´ìš© ê°€ëŠ¥í•˜ë©°, í•´ì§€ ì‹œ ê´€ë ¨ ì ˆì°¨ë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.</p>
			<h4>ì œ4ì¡° (ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸)</h4>
			<p>ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸ëŠ” ë³¸ì¸ë§Œ ì•Œ ìˆ˜ ìˆë„ë¡ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>
		</div>
	</div>
</div>

<footer> &copy; 2025 Wedding Planner Co. All rights reserved.</footer>

<script src="/js/auth-buttons.js"></script>
<script>
window.onload = function() {
	document.activeElement.blur();
};

const passwordInput = document.getElementById("passwordInput");
const passwordDisplay = document.getElementById("passwordDisplay");
const keypad = document.getElementById("keypad");

function showKeypad() { keypad.style.display = "grid"; }
function hideKeypad() { keypad.style.display = "none"; }
function updateDisplay() {
	const length = passwordInput.value.length;
	let display = "";
	for (let i = 0; i < 4; i++) display += i < length ? "â— " : "â—‹ ";
	passwordDisplay.textContent = display.trim();
}
function addNumber(num) { if(passwordInput.value.length<4){ passwordInput.value+=num; updateDisplay(); } }
function removeNumber() { passwordInput.value=passwordInput.value.slice(0,-1); updateDisplay(); }
function preventTyping(event){ event.preventDefault(); }

function openModal(e){ e.preventDefault(); document.getElementById("termsModal").style.display="flex"; }
function closeModal(){ document.getElementById("termsModal").style.display="none"; }

function submitForm(){
	if(passwordInput.value.length!==4){ alert("ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); showKeypad(); passwordDisplay.focus(); return false; }
	if(!document.getElementById("agree").checked){ alert("ì•½ê´€ì— ë™ì˜í•´ì•¼ ê³„ì¢Œë¥¼ ê°œì„¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return false; }
	return true;
}
updateDisplay();
passwordDisplay.addEventListener("keydown", preventTyping);

// âœ… ìˆ˜ì •ëœ ì´ë©”ì¼ ì¸ì¦ í•¨ìˆ˜ë“¤
function sendEmailVerification(event){
	console.log("ğŸš¨ ì´ë©”ì¼ ì¸ì¦ ìš”ì²­ ì‹œì‘");
	
	const button = event.target;
	const email = document.getElementById("email").value;
	
	if(!email || !email.includes("@")){ 
		alert("ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”."); 
		return; 
	}
	
	const originalText = button.textContent;
	button.textContent="ë°œì†¡ ì¤‘...";
	button.disabled=true;

	// âœ… Gatewayë¥¼ í†µí•œ ê²½ë¡œë¡œ ìˆ˜ì •
	fetch('/banking/account/send-verification',{
		method:'POST',
		headers:{ 
			'Content-Type':'application/x-www-form-urlencoded',
			'X-Requested-With':'XMLHttpRequest' 
		},
		body:'email='+encodeURIComponent(email),
		credentials: 'include'  // ì¿ í‚¤ ì „ì†¡ (JWT í† í°ìš©)
	})
	.then(res => {
		console.log("ì‘ë‹µ ìƒíƒœ:", res.status);
		return res.json();
	})
	.then(data=>{
		console.log("ì‘ë‹µ ë°ì´í„°:", data);
		if(data.success){
			alert("âœ… "+data.message);
			document.getElementById("emailVerifySection").style.display="block";
		}else {
			alert("âŒ "+data.message);
			console.error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:", data);
		}
	})
	.catch(err=>{ 
		console.error("fetch ì˜¤ë¥˜:", err); 
		alert("âŒ ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”."); 
	})
	.finally(()=>{ 
		button.textContent=originalText; 
		button.disabled=false; 
	});
}

function verifyEmailCode(event){
	console.log("ğŸš¨ ì´ë©”ì¼ ì¸ì¦ í™•ì¸ ì‹œì‘");
	
	const button=event.target;
	const email=document.getElementById("email").value;
	const code=document.getElementById("emailCode").value;
	
	if(!code || code.length!==6){ 
		alert("6ìë¦¬ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); 
		return; 
	}

	const originalText=button.textContent;
	button.textContent="í™•ì¸ ì¤‘...";
	button.disabled=true;

	// âœ… Gatewayë¥¼ í†µí•œ ê²½ë¡œë¡œ ìˆ˜ì •
	fetch('/banking/account/verify-email',{
		method:'POST',
		headers:{ 
			'Content-Type':'application/x-www-form-urlencoded',
			'X-Requested-With':'XMLHttpRequest' 
		},
		body:'email='+encodeURIComponent(email)+'&code='+encodeURIComponent(code),
		credentials: 'include'
	})
	.then(res => {
		console.log("ì¸ì¦ í™•ì¸ ì‘ë‹µ ìƒíƒœ:", res.status);
		return res.json();
	})
	.then(data=>{
		console.log("ì¸ì¦ í™•ì¸ ì‘ë‹µ ë°ì´í„°:", data);
		if(data.success){
			alert("âœ… "+data.message);
			const codeInput=document.getElementById("emailCode");
			codeInput.style.backgroundColor="#d4edda";
			codeInput.readOnly=true;
			button.textContent="âœ… ì¸ì¦ ì™„ë£Œ";
			button.style.backgroundColor="#28a745";
		}else{
			alert("âŒ "+data.message);
			button.textContent=originalText;
			button.disabled=false;
		}
	})
	.catch(err=>{ 
		console.error("ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:", err); 
		alert("âŒ ì¸ì¦ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); 
		button.textContent=originalText; 
		button.disabled=false; 
	});
}
</script>
</body>
</html>