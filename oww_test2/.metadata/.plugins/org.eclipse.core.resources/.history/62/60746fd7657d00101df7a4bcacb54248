// ========================================
// ê³„ì¢Œ ê´€ë ¨ í•¨ìˆ˜ë“¤
// ========================================

function loadAccountInfo() {
	fetch('http://localhost:8201/api/banking/api/account', {
		console.log('API í˜¸ì¶œ URL:', url); // ë””ë²„ê¹…ìš©
		method: 'GET',
		credentials: 'include'
	})
		.then(res => res.json())
		.then(data => {
			if (data.success) {
				// ì¼ë°˜ ê³„ì¢Œ ì²˜ë¦¬
				if (data.hasAccount) {
					// ê³„ì¢Œ ìˆìŒ - ì‹¤ì œ ë°ì´í„° í‘œì‹œ
					document.querySelector('.service-card:first-child .balance-amount').textContent =
						`â‚©${data.balance.toLocaleString()}`;
					document.querySelector('.service-card:first-child h2').textContent =
						data.accountNumber;
					// ì‚¬ìš©ì ì´ë¦„ë„ ì—…ë°ì´íŠ¸
					document.querySelector('#user-name-display').textContent = data.userName;
					document.querySelector('#user-email-display').textContent = data.userEmail;
				} else {
					// ê³„ì¢Œ ì—†ìŒ - ìƒì„± ìœ ë„
					document.querySelector('.service-card:first-child').innerHTML = `
                    <div style="text-align: center; padding: 30px; width: 100%;">
                        <h2>ğŸ“­ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p style="margin: 15px 0; color: #666;">
                            Own Wedding Wallet ê³„ì¢Œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”
                        </p>
                        <button onclick="goToCreateAccount()"
                                style="padding: 12px 30px;
                                       background: #ff726f;
                                       color: white;
                                       border: none;
                                       border-radius: 20px;
                                       cursor: pointer;
                                       font-weight: 600;">
                            ê³„ì¢Œ ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                `;
				}

				// ì„¸ì´í”„ë°•ìŠ¤ ì²˜ë¦¬
				if (data.hasSafebox) {
					document.querySelector('.service-card:nth-child(2) .balance-amount').textContent =
						`â‚©${data.safeboxBalance.toLocaleString()}`;
				} else {
					document.querySelector('.service-card:nth-child(2)').innerHTML = `
                    <div style="text-align: center; padding: 30px; width: 100%;">
                        <h2>ğŸ”’ ì„¸ì´í”„ë°•ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p style="margin: 15px 0; color: #666;">
                            ì„¸ì´í”„ë°•ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì•ˆì „í•˜ê²Œ ìê¸ˆì„ ë³´ê´€í•˜ì„¸ìš”
                        </p>
                        <button onclick="goToCreateSafebox()"
                                style="padding: 12px 30px;
                                       background: #ff726f;
                                       color: white;
                                       border: none;
                                       border-radius: 20px;
                                       cursor: pointer;
                                       font-weight: 600;">
                            ì„¸ì´í”„ë°•ìŠ¤ ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                `;
				}

				// ì„œë¹„ìŠ¤ ì¹´ë“œ í‘œì‹œ
				document.getElementById('service-cards').style.display = 'block';
			} else {
				console.error('API ì‘ë‹µ ì‹¤íŒ¨:', data.message);
			}
		})
		.catch(err => {
			console.error('ê³„ì¢Œ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', err);
		});
}

// ê³„ì¢Œ ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
function goToCreateAccount() {
	window.location.href = '/banking/createAccount';
}

// ì„¸ì´í”„ë°•ìŠ¤ ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
function goToCreateSafebox() {
	window.location.href = '/banking/safebox';
}

// Banking ì„œë¹„ìŠ¤ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
function setupBankingButtons() {
	document.querySelectorAll('.banking-btn').forEach(btn => {
		btn.addEventListener('click', function(e) {
			e.preventDefault();
			const url = btn.dataset.url;
			const redirect = btn.dataset.redirect;

			fetch(url, {
				method: 'GET',
				credentials: 'include'
			})
				.then(res => {
					if (!res.ok) throw new Error('ì¸ì¦ í•„ìš”');
					window.location.href = redirect;
				})
				.catch(err => alert(err.message));
		});
	});
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
	loadAccountInfo();
	setupBankingButtons();
});