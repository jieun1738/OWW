// 수정된 로그인 상태 확인 함수
function isUserLoggedIn() {
    // 1. 쿠키에서 JWT 토큰 확인
    const cookies = document.cookie.split(';');
    const jwtToken = cookies.find(cookie => 
        cookie.trim().startsWith('accessToken=') || 
        cookie.trim().startsWith('jwt=') ||
        cookie.trim().startsWith('token=')
    );
    
    if (jwtToken) {
        console.log('JWT 토큰 발견:', jwtToken);
        return true;
    }
    
    // 2. 백업으로 localStorage/sessionStorage 확인 (기존 방식)
    return localStorage.getItem('isLoggedIn') === 'true' || 
           sessionStorage.getItem('userToken') !== null;
}

// 또는 더 간단한 방식: API 요청으로 인증 상태 확인
async function checkAuthenticationStatus() {
    try {
        const response = await fetch('http://localhost:8201/api/banking/account', {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            return data.success === true;
        }
        return false;
    } catch (error) {
        console.error('인증 상태 확인 실패:', error);
        return false;
    }
}

// navigateToService 함수도 수정
function navigateToService(path) {
    // 쿠키 기반 인증 확인
    const hasJwtCookie = document.cookie.includes('accessToken=') || 
                        document.cookie.includes('jwt=') || 
                        document.cookie.includes('token=');
    
    if (!hasJwtCookie) {
        alert('로그인이 필요합니다.');
        login();
        return;
    }
    
    window.location.href = path;
}

// setupBankingButtons 함수도 수정
function setupBankingButtons() {
    document.querySelectorAll('.banking-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            
            const url = btn.dataset.url;
            const redirect = btn.dataset.redirect;
            
            if (!url || !redirect) {
                console.error('버튼에 필요한 데이터 속성이 없습니다:', btn);
                return;
            }
            
            // 쿠키 기반 인증 확인
            const hasJwtCookie = document.cookie.includes('accessToken=') || 
                                document.cookie.includes('jwt=') || 
                                document.cookie.includes('token=');
            
            if (!hasJwtCookie) {
                alert('로그인이 필요합니다.');
                login();
                return;
            }
            
            // 버튼 비활성화 (중복 클릭 방지)
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = '처리중...';
            
            // 직접 리다이렉트 (API 호출 없이)
            window.location.href = redirect;
        });
    });
}