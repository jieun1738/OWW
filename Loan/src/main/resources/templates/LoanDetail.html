<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
<meta charset="UTF-8">
<title layout:fragment="title">ëŒ€ì¶œìƒí’ˆ ìƒì„¸ | OWW</title>
  <link rel="stylesheet" th:href="@{/css/Loanmain.css}">
</head>
<body>
	<section layout:fragment="content">
		<div class="page">
			<!-- âœ… ì‚¬ì´ë“œë°”: ê¸°ì¡´ í”„ë˜ê·¸ë¨¼íŠ¸ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì¤‘ë³µ ì„ ì–¸ ê¸ˆì§€) -->
			<div th:replace="~{fragments/MainSideBar :: sidebar(user=${user}, active='LoanMain', progress=${progressPercent})}"></div>
			<div class="cards">
				<!-- Main Content -->
				<main class="content">
					<!-- í—¤ë” -->
					<header class="page-header">
						<div>
							<h1 class="title">ëŒ€ì¶œ ìƒí’ˆ ìƒì„¸ë³´ê¸°</h1>
								<p class="desc">OWW ëŒ€ì¶œìƒí’ˆì„ í™•ì¸í•˜ê³  ê°€ì…í•˜ì„¸ìš”</p>
						</div>													
					</header>
					
		<div class="card-detail">
    	<h1 class="title" th:text="|ğŸ’°${loandetails.loanName}ğŸ’°|">ìƒí’ˆëª…</h1>
    
    <p><strong>ìƒì„¸ ì„¤ëª…:</strong><br> <span th:text="${loandetails.LoanExplanation}"> ì„¤ëª…</span></p>
    <p><strong>ëŒ€ì¶œ í•œë„:</strong><br><span th:text="${loandetails.LoanLimit}">-</span> ì›</p>
    <p><strong>ëŒ€ì¶œ ê¸°ê°„(ê°œì›”):</strong><br><span th:text="${loandetails.LoanPeriod}">-</span> ê°œì›”</p>
    <p><strong>ìƒí™˜ ë°©ì‹:</strong><br>
        <span th:switch="${loandetails.LoanRepaymentType}">
            <span th:case="0">ì›ë¦¬ê¸ˆ ê· ë“±ìƒí™˜</span>
            <span th:case="1">ì›ê¸ˆê· ë“±ìƒí™˜</span>
            <span th:case="*">-</span>
        </span>
    </p>
    <p><strong>ì´ììœ¨(%):</strong> <span th:text="${loandetails.InterestRate}">-</span> %</p>
</div>
<div class="card-detail">
	
<form th:action="@{/insertloan}" id="loanForm" class="loan-form">
    <div class="input-row">
	<label for="loanamount">ëŒ€ì¶œê¸ˆ ì…ë ¥:</label>
    <input type="text" name="loanamount" id="loanamount" class="input-field" placeholder="ìˆ«ìë§Œ ì…ë ¥">
    <input type="hidden" name="loanname" th:value="${loandetails.loanName}">
    <input type="hidden" name="loanperiod" th:value="${loandetails.LoanPeriod}">
    <input type="hidden" name="loanrepaymenttype" th:value="${loandetails.LoanRepaymentType}">
    <input type="hidden" name="interestrate" th:value="${loandetails.InterestRate}">
    </div>
	<button type="submit" class="btn-gaip">ê°€ì…í•˜ê¸°</button>
</form>
</div>
				</main>
			</div>
		</div>
	</section>
<script th:inline="javascript">
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById('loanForm');
    form.addEventListener('submit', function(event) {
        const loanamountInput = document.getElementById('loanamount');
        const loanamount = loanamountInput.value.trim();
        const loanLimit = /*[[${loandetails.LoanLimit}]]*/ 0;

        if (loanamount === '') {
            alert('ëŒ€ì¶œê¸ˆì„ ì…ë ¥í•˜ì„¸ìš”.');
            event.preventDefault();
            return;
        }
        if (!/^\d+$/.test(loanamount)) {
            alert('ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            event.preventDefault();
            return; 
        }
        const amountNum = Number(loanamount);
        if (amountNum <= 0) {
            alert('ëŒ€ì¶œê¸ˆì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
            event.preventDefault();
            return;
        }
        if (amountNum > loanLimit) {
            alert('ëŒ€ì¶œê¸ˆì€ ëŒ€ì¶œ í•œë„ ' + loanLimit + 'ì›ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            event.preventDefault();
            return;
        }
    });
});
</script>
</body>
</html>
