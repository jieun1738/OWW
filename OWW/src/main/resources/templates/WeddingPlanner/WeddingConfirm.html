<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
  <title layout:fragment="title">임시 보관 확인 | OWW</title>
  <link rel="stylesheet" th:href="@{/css/WeddingConfirm.css}" />
</head>
<body>
<section layout:fragment="content">
  <div class="page" id="wpconfirm">
    <div th:replace="~{fragments/MainSideBar :: sidebar(
        user=${user},
        active='WeddingPlanner/WeddingConfirm',
        progress=${progressPercent}
    )}"></div>

    <main class="content"
          th:with="
            safeItems = ${(planItems == null) ? #lists.list() : planItems},
            safeHas   = ${(hasPlan  == null) ? false          : hasPlan},
            safeTotal = ${(planTotal== null) ? 0              : planTotal},
            safeIndex = ${(planIndex== null) ? -1             : planIndex}
          ">
      <h1 class="title">임시 보관 확인 | 미리보기</h1>
      <p class="desc">DIY에서 저장한 구성을 확인하고 보관함으로 이동합니다.</p>

      <div class="empty" th:if="${!safeHas}">
        <i class="bx bx-info-circle" aria-hidden="true"></i>
        보관할 플랜이 없습니다. 먼저 DIY에서 저장하거나 보관함에서 선택하세요.
        <div style="margin-top:10px">
          <a class="btn" th:href="@{/planner/WeddingPlanList}">
            <i class="bx bx-chevron-left" aria-hidden="true"></i> 임시 플랜 보관함
          </a>
        </div>
      </div>

      <div th:if="${safeHas}">
        <div class="cards">
          <article class="card" th:each="v : ${safeItems}">
            <div class="thumb">
              <img th:if="${v != null and v.img != null and !#strings.isEmpty(v.img)}"
                   th:src="@{${v.img}}" alt="">
              <div class="noimg" th:if="${v == null or v.img == null or #strings.isEmpty(v.img)}">
                <i class="bx bx-image-alt" aria-hidden="true"></i> 이미지가 없음
              </div>
            </div>
            <div class="meta">
              <h3 th:text="${v != null ? v.productName : '미지정'}">상품명</h3>
              <div class="sub">
                <span th:text="${v != null ? (v.category == 0 ? '웨딩홀' : (v.category==1 ? '스튜디오' : (v.category==2 ? '드레스' : '메이크업'))) : '-'}">카테고리</span>
                · <span th:text="${v != null ? v.address : '-'}">주소</span>
              </div>
              <div class="price" th:text="${v != null ? #numbers.formatInteger(v.cost,3,'COMMA') + '원' : '0원'}">0원</div>
            </div>
          </article>
        </div>

        <div class="total">
          합계
          <strong th:text="${#numbers.formatInteger(safeTotal,3,'COMMA') + '원'}">0원</strong>
        </div>

        <div class="actions">
          <a class="btn ghost" th:href="@{/planner/WeddingPlanList}">
            <i class="bx bx-chevron-left" aria-hidden="true"></i> 보관함으로
          </a>
          <a class="btn primary"
             th:href="@{/planner/confirm/finalize(idx=${safeIndex})}">
            <i class="bx bx-check-circle" aria-hidden="true"></i> 임시 보관 확정
          </a>
        </div>
      </div>
    </main>
  </div>
</section>
</body>
</html>
